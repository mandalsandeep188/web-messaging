(this["webpackJsonpweb-messenger"]=this["webpackJsonpweb-messenger"]||[]).push([[0],{39:function(e,t,n){},40:function(e,t,n){},55:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(26),s=n.n(r),i=(n(39),n.p,n(40),n(20)),o=n(4),u=n(14),l=n(7),d=n(9),j=n.n(d),b=n(17),f=n(12),p=n.n(f),h="USER_LOGIN",O="USER_LOGOUT",m="GET_REALTIME_USERS",g="GET_REALTIME_MESSAGES",x=n(6),v=(n(55),n(2)),S=function(e){var t=Object(l.c)((function(e){return e.auth})),n=Object(l.b)();return Object(v.jsxs)("header",{className:"header",children:[Object(v.jsxs)("div",{style:{display:"flex"},children:[Object(v.jsx)("div",{className:"logo",children:"Web Messenger"}),t.authenticated?null:Object(v.jsxs)("ul",{className:"leftMenu",children:[Object(v.jsx)("li",{children:Object(v.jsx)(i.c,{to:"/login",children:"Login"})}),Object(v.jsx)("li",{children:Object(v.jsx)(i.c,{to:"/signup",children:"Sign up"})})]})]}),Object(v.jsx)("div",{style:{margin:"20px 0",color:"#fff",fontWeight:"bold"},children:t.authenticated?"Hi ".concat(t.firstName," ").concat(t.lastName):""}),Object(v.jsx)("ul",{className:"menu",children:t.authenticated?Object(v.jsx)("li",{children:Object(v.jsx)(i.b,{to:"#",onClick:function(){var e;n((e=t.uid,function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:"".concat(O,"_REQUEST")}),Object(f.firestore)().collection("users").doc(e).update({isOnline:!1}).then((function(){Object(f.auth)().signOut().then((function(){localStorage.clear(),n({type:"".concat(O,"_SUCCESS")})})).catch((function(e){console.log(e),n({type:"".concat(O,"_FAILURE"),payload:{error:e}})}))})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},children:"Logout"})}):null})]})},y=function(e){return Object(v.jsxs)("div",{children:[Object(v.jsx)(S,{}),e.children]})},N=(n(58),function(e){var t=e.user,n=e.onClick;return Object(v.jsxs)("div",{onClick:function(){return n(t)},className:"displayName",children:[Object(v.jsx)("div",{className:"displayPic",children:Object(v.jsx)("img",{src:"https://i.pinimg.com/originals/be/ac/96/beac96b8e13d2198fd4bb1d5ef56cdcf.jpg",alt:""})}),Object(v.jsxs)("div",{style:{display:"flex",flex:1,justifyContent:"space-between",margin:"0 10px"},children:[Object(v.jsxs)("span",{style:{fontWeight:500},children:[t.firstName," ",t.lastName]}),Object(v.jsx)("span",{className:t.isOnline?"onlineStatus":"onlineStatus off"})]})]})}),_=function(e){var t,n=Object(l.b)(),a=Object(l.c)((function(e){return e.auth})),r=Object(l.c)((function(e){return e.user})),s=Object(c.useState)(!1),i=Object(u.a)(s,2),o=i[0],d=i[1],p=Object(c.useState)(""),h=Object(u.a)(p,2),O=h[0],S=h[1],_=Object(c.useState)(""),E=Object(u.a)(_,2),w=E[0],C=E[1],U=Object(c.useState)(null),I=Object(u.a)(U,2),k=I[0],A=I[1];Object(c.useEffect)((function(){var e;t=n((e=a.uid,function(){var t=Object(b.a)(j.a.mark((function t(n){var c,a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:"".concat(m,"_REQUEST")}),c=Object(f.firestore)(),a=c.collection("users").onSnapshot((function(t){var c=[];t.forEach((function(t){t.data().uid!=e&&c.push(t.data())})),n({type:"".concat(m,"_SUCCESS"),payload:{users:c}})})),t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())).then((function(e){return e})).catch((function(e){console.log(e)}))}),[]),Object(c.useEffect)((function(){return function(){t.then((function(e){return e()})).catch((function(e){return console.log(e)}))}}),[]);var R=function(e){d(!0),S("".concat(e.firstName," ").concat(e.lastName)),A(e.uid),console.log(e),n(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object(f.firestore)().collection("conversations").where("user_uid_1","in",[e.uid_1,e.uid_2]).orderBy("createdAt","asc").onSnapshot((function(t){var c=[];t.forEach((function(t){(t.data().user_uid_1==e.uid_1&&t.data().user_uid_2==e.uid_2||t.data().user_uid_1==e.uid_2&&t.data().user_uid_2==e.uid_1)&&c.push(t.data()),c.length>0?n({type:g,payload:{conversations:c}}):n({type:"".concat(g,"_FAILURE"),payload:{conversations:c}})})),console.log(c)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}({uid_1:a.uid,uid_2:e.uid}))};return Object(v.jsx)(y,{children:Object(v.jsxs)("section",{className:"container",children:[Object(v.jsx)("div",{className:"listOfUsers",children:r.users.length>0?r.users.map((function(e){return Object(v.jsx)(N,{onClick:R,user:e},e.uid)})):null}),Object(v.jsxs)("div",{className:"chatArea",children:[Object(v.jsx)("div",{className:"chatHeader",children:o?O:""}),Object(v.jsx)("div",{className:"messageSections",children:o?r.conversations.map((function(e){return Object(v.jsx)("div",{style:{textAlign:e.user_uid_1==a.uid?"right":"left"},children:Object(v.jsx)("p",{className:"messageStyle",children:e.message})})})):null}),o?Object(v.jsxs)("div",{className:"chatControls",children:[Object(v.jsx)("textarea",{value:w,onChange:function(e){return C(e.target.value)},placeholder:"Write Message"}),Object(v.jsx)("button",{onClick:function(e){var t={user_uid_1:a.uid,user_uid_2:k,message:w};""!=w&&n(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object(f.firestore)().collection("conversations").add(Object(x.a)(Object(x.a)({},e),{},{isView:!1,createdAt:new Date})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t)).then((function(){C("")}))},children:"Send"})]}):null]})]})})},E=(n(59),function(e){return Object(v.jsx)("div",{className:"card",children:e.children})}),w=(n(60),function(e){var t=Object(c.useState)(""),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(c.useState)(""),i=Object(u.a)(s,2),d=i[0],p=i[1],O=Object(l.b)();return Object(l.c)((function(e){return e.auth})).authenticated?Object(v.jsx)(o.a,{to:"/"}):Object(v.jsx)(y,{children:Object(v.jsx)("div",{className:"loginContainer",children:Object(v.jsx)(E,{children:Object(v.jsxs)("form",{onSubmit:function(e){var t;(e.preventDefault(),""!==a)?""!==d?O((t={email:a,password:d},function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:"".concat(h,"_REQUEST")}),Object(f.auth)().signInWithEmailAndPassword(t.email,t.password).then((function(e){console.log(e),Object(f.firestore)().collection("users").doc(e.user.uid).update({isOnline:!0}).then((function(){var t=e.user.displayName.split(" "),c={firstName:t[0],lastName:t[1],uid:e.user.uid,email:e.user.email};localStorage.setItem("user",JSON.stringify(c)),n({type:"".concat(h,"_SUCCESS"),payload:{user:c}})})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})).catch((function(e){console.log(e),n({type:"".concat(h,"_FAILURE"),payload:{error:e}})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())):alert("Password is required"):alert("Email is required")},children:[Object(v.jsx)("input",{name:"email",type:"text",onChange:function(e){return r(e.target.value)},placeholder:"Email"}),Object(v.jsx)("input",{name:"password",type:"password",onChange:function(e){return p(e.target.value)},placeholder:"Password"}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{children:"Login"})})]})})})})}),C=function(e){var t=Object(l.b)(),n=Object(l.c)((function(e){return e.auth})),a=Object(c.useState)(""),r=Object(u.a)(a,2),s=r[0],i=r[1],d=Object(c.useState)(""),p=Object(u.a)(d,2),O=p[0],m=p[1],g=Object(c.useState)(""),x=Object(u.a)(g,2),S=x[0],N=x[1],_=Object(c.useState)(""),w=Object(u.a)(_,2),C=w[0],U=w[1];return n.authenticated?Object(v.jsx)(o.a,{to:"/"}):Object(v.jsx)(y,{children:Object(v.jsx)("div",{className:"registerContainer",children:Object(v.jsx)(E,{children:Object(v.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(n){var c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=Object(f.firestore)(),n({type:"".concat(h,"_REQUEST")}),Object(f.auth)().createUserWithEmailAndPassword(e.email,e.password).then((function(t){console.log(t);var a=Object(f.auth)().currentUser,r="".concat(e.firstName," ").concat(e.lastName);a.updateProfile({displayName:r}).then((function(){c.collection("users").doc(t.user.uid).set({firstName:e.firstName,lastName:e.lastName,uid:t.user.uid,createdAt:new Date,isOnline:!0}).then((function(){var c={firstName:e.firstName,lastName:e.lastName,uid:t.user.uid,email:e.email};localStorage.setItem("user",JSON.stringify(c)),console.log("User logged in successfully!"),n({type:"".concat(h,"_SUCCESS"),payload:{user:c}})})).catch((function(e){console.log(e),n({type:"".concat(h,"_FAILURE"),payload:{error:e}})}))}))})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}({firstName:s,lastName:O,email:S,password:C}))},children:[Object(v.jsx)("h3",{children:"Sign up"}),Object(v.jsx)("input",{name:"firstName",type:"text",onChange:function(e){return i(e.target.value)},placeholder:"First Name"}),Object(v.jsx)("input",{name:"lastName",type:"text",onChange:function(e){return m(e.target.value)},placeholder:"Last Name"}),Object(v.jsx)("input",{name:"email",type:"text",onChange:function(e){return N(e.target.value)},placeholder:"Email"}),Object(v.jsx)("input",{name:"password",type:"password",onChange:function(e){return U(e.target.value)},placeholder:"Password"}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{children:"Sign up"})})]})})})})},U=n(34),I=["component"],k=function(e){var t=e.component,n=Object(U.a)(e,I);return Object(v.jsx)(o.b,Object(x.a)(Object(x.a)({},n),{},{component:function(e){return(localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null)?Object(v.jsx)(t,Object(x.a)({},e)):Object(v.jsx)(o.a,{to:"/login"})}}))};var A=function(){var e=Object(l.c)((function(e){return e.auth})),t=Object(l.b)();return Object(c.useEffect)((function(){e.authenticated||t(function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,t(n?{type:"".concat(h,"_SUCCESS"),payload:{user:n}}:{type:"".concat(h,"_FAILURE"),payload:{error:"Login again please"}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)(i.a,{children:[Object(v.jsx)(k,{path:"/",exact:!0,component:_}),Object(v.jsx)(o.b,{path:"/login",component:w}),Object(v.jsx)(o.b,{path:"/signup",component:C})]})})},R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,62)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))},L=n(23),T=n(33),F={firstName:"",lastName:"",email:"",authenticating:!1,authenticated:!1,error:null},P={users:[],conversations:[]},Q=Object(L.b)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(console.log(t),t.type){case"".concat(h,"_REQUEST"):e=Object(x.a)(Object(x.a)({},e),{},{authenticating:!0});break;case"".concat(h,"_SUCCESS"):e=Object(x.a)(Object(x.a)(Object(x.a)({},e),t.payload.user),{},{authenticated:!0,authenticating:!1});break;case"".concat(h,"_FAILURE"):e=Object(x.a)(Object(x.a)({},e),{},{authenticated:!1,authenticating:!1,error:t.payload.error});break;case"".concat(O,"_REQUEST"):break;case"".concat(O,"_SUCCESS"):e=Object(x.a)({},F);break;case"".concat(O,"_FAILURE"):e=Object(x.a)(Object(x.a)({},e),{},{error:t.payload.error})}return e},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"".concat(m,"_REQUEST"):break;case"".concat(m,"_SUCCESS"):e=Object(x.a)(Object(x.a)({},e),{},{users:t.payload.users});break;case g:e=Object(x.a)(Object(x.a)({},e),{},{conversations:t.payload.conversations})}return e}}),W=Object(L.c)(Q,Object(L.a)(T.a));p.a.initializeApp({apiKey:"AIzaSyBZW7o6d24cNuywBFQFXuYnbOoDSoJ-hTg",authDomain:"web-messenger-40c9b.firebaseapp.com",projectId:"web-messenger-40c9b",storageBucket:"web-messenger-40c9b.appspot.com",messagingSenderId:"645405261953",appId:"1:645405261953:web:4da0517c6d1cd989a9cd80",measurementId:"G-HRWL1043SH"}),window.store=W,s.a.render(Object(v.jsxs)(l.a,{store:W,children:[Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(A,{})}),","]}),document.getElementById("root")),R()}},[[61,1,2]]]);
//# sourceMappingURL=main.7eafcc5d.chunk.js.map